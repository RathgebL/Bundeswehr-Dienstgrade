{% extends "base/base.html" %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/styles/pages/home.css') }}">
{% endblock %}

{% block content %}
<div class="page-box page--narrow">
  <h1 class="heading-primary">Karteikarten</h1>

  <!-- Karte -->
  <div id="flashcard" class="card-wrapper w-320 max-h-200">
    <div class="card__flip" onclick="flipCard()">
      <!-- Vorderseite: Buchstabe -->
      <div class="card__face">
        <h1 id="nato-letter" class="nato-letter">{{ entries[0].letter }}</h1>
        <p class="card__hint">Klicke zum Umdrehen</p>
      </div>

      <!-- Rückseite: Wort -->
      <div class="card__face card__face--back">
        <h2 id="nato-word" class="nato-word">{{ entries[0].correct }}</h2>
      </div>
    </div>
  </div>

  <!-- Steuerung -->
  <div class="btn-wrapper">
    <div class="btn-group">
      <button class="btn btn--primary w-200" onclick="prevCard()">Vorherige Karte</button>
      <button class="btn btn--primary w-200" onclick="nextCard()">Nächste Karte</button>
      <button class="btn btn--primary w-200" onclick="shuffleCards()">Mischen</button>
      <button class="btn btn--primary w-200" onclick="resetCards()">Ordnen</button>
    </div>
  </div>

  <!-- Zurück -->
  <a href="{{ url_for('nato.nato_menu') }}" class="btn btn--secondary w-200">Zurück zum Menü</a>

</div>

<script>
const entriesInitial = {{ entries|tojson|safe }};
let entries = [...entriesInitial];
let currentIndex = 0;
let entriesOriginal = [...entriesInitial];

const flipContainer = document.querySelector(".card__flip");
const letterEl = document.getElementById("nato-letter");
const wordEl = document.getElementById("nato-word");

function flipCard() {
  flipContainer.classList.toggle("is-flipped");
}

function updateCard() {
  const entry = entries[currentIndex];
  letterEl.innerText = entry.letter;
  wordEl.innerText = entry.correct;
}

function nextCard() {
  flipContainer.classList.remove("is-flipped");
  currentIndex = (currentIndex + 1) % entries.length;
  updateCard();
}

function prevCard() {
  flipContainer.classList.remove("is-flipped");
  currentIndex = (currentIndex - 1 + entries.length) % entries.length;
  updateCard();
}

function shuffleCards() {
  for (let i = entries.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [entries[i], entries[j]] = [entries[j], entries[i]];
  }
  currentIndex = 0;
  updateCard();
  triggerShake();
}

function resetCards() {
  entries = [...entriesOriginal];
  currentIndex = 0;
  updateCard();
  triggerShake();
}

function triggerShake() {
  flipContainer.classList.add("shake");
  setTimeout(() => flipContainer.classList.remove("shake"), 400);
}
</script>
{% endblock %}