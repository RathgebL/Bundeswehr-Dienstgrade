{% extends "base.html" %}

{% block content %}
<h1 class="mb-4 text-center">Karteikarten</h1>

<!-- Filterbereich -->
<div class="ranks-filter">
  <form method="get" action="{{ url_for('main.flashcards') }}">
    <label for="branch">Truppenteil:</label>
    <select name="branch" id="branch" onchange="this.form.submit()">
      <option value="Alle" {% if selected_branch == 'Alle' %}selected{% endif %}>Alle</option>
      <option value="Heer" {% if selected_branch == 'Heer' %}selected{% endif %}>Heer</option>
      <option value="Luftwaffe" {% if selected_branch == 'Luftwaffe' %}selected{% endif %}>Luftwaffe</option>
      <option value="Marine" {% if selected_branch == 'Marine' %}selected{% endif %}>Marine</option>
    </select>
  </form>
</div>

<!-- Karteikarten -->
<div class="flashcards">
    <div id="flashcard" class="flashcard-container">
        <div class="card-flip" onclick="flipCard()">
            <div class="card-face card-front">
                <img id="rank-image" src="{{ url_for('static', filename='images/' + ranks[0].image_filename) }}"
                     alt="{{ ranks[0].title }}" class="rank-image">
                <p class="flip-hint">Klick zum Umdrehen</p>
            </div>
            <div class="card-face card-back">
                <h4 id="rank-title">{{ ranks[0].title }}</h4>

                <div id="rank-meta" class="rank-meta-clean">
                    <p id="rank-abbr">{{ ranks[0].abbreviation or "-" }}</p>
                    <p id="rank-group">{{ ranks[0].rank_group or ranks[0].rank_type or "-" }}</p>
                    <p id="rank-nato">{{ ranks[0].level_code or "-" }}</p>
                </div>

                <p id="rank-desc" class="rank-desc">{{ ranks[0].description }}</p>
            </div>
        </div>
    </div>

    <div class="flashcard-controls">
        <button class="btn-prev" onclick="prevCard()">Vorherige Karte</button>
        <button class="btn-next" onclick="nextCard()">NÃ¤chste Karte</button>
    </div>
</div>

<script>
const ranks = {{ ranks|tojson|safe }};
let currentIndex = 0;

const flipContainer = document.querySelector(".card-flip");
const img = document.getElementById("rank-image");
const title = document.getElementById("rank-title");
const desc = document.getElementById("rank-desc");

function flipCard() {
    flipContainer.classList.toggle("flipped");
}

function nextCard() {
    flipContainer.classList.remove("flipped");
    currentIndex = (currentIndex + 1) % ranks.length;
    const rank = ranks[currentIndex];
    img.src = `/static/images/${rank.image_filename}`;
    img.alt = rank.title;
    title.innerText = rank.title;
    desc.innerText = rank.description;
}

function prevCard() {
    flipContainer.classList.remove("flipped");
    currentIndex = (currentIndex - 1 + ranks.length) % ranks.length;
    const rank = ranks[currentIndex];
    img.src = `/static/images/${rank.image_filename}`;
    img.alt = rank.title;
    title.innerText = rank.title;
    desc.innerText = rank.description;

    document.getElementById("rank-abbr").innerText = rank.abbreviation || "-";
    document.getElementById("rank-group").innerText = rank.rank_group || rank.rank_type || "-";
    document.getElementById("rank-nato").innerText = rank.level_code || "-";
}

</script>
{% endblock %}